name: PR Automation

on:
  push:
    branches-ignore:
      - main
      - master

jobs:
  create-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.FINANCE_APP }}
      
      - name: Get changed files
        id: file-changes
        run: |
          if [ "${{ github.event.before }}" != "0000000000000000000000000000000000000000" ]; then
            echo "files=$(git diff --name-only ${{ github.event.before }} ${{ github.event.after }} | tr '\n' ' ')" >> $GITHUB_OUTPUT
          else
            echo "files=$(git diff --name-only HEAD~1 HEAD | tr '\n' ' ')" >> $GITHUB_OUTPUT
          fi
      
      - name: Create or Update PR
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.FINANCE_APP }}
          commit-message: "feat: Automated PR for recent changes"
          title: "ğŸ¤– Automated PR: Recent Changes"
          body: |
            ## ğŸ”„ Automated Pull Request
            
            ### ğŸ“ Changes include:
            ${{ github.event.head_commit.message }}
            
            ### ğŸ” Review Points:
            - [ ] Code follows project standards
            - [ ] Tests are included and passing
            - [ ] Documentation is updated
            - [ ] No breaking changes introduced
            
            ### ğŸ“¦ Changed Files:
            ```
            ${{ steps.file-changes.outputs.files }}
            ```
            
            ### ğŸš€ Branch: `${{ github.ref_name }}`
          branch: ${{ github.ref_name }}
          base: main
          labels: |
            automated-pr
            needs-review 